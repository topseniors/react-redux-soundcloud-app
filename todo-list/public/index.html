<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Simple Vue.js to-do list demo">
    <meta name="author" content="Mike Sprague">
    <title>Simple Vue.js to-do list demo | &lt;/&gt; by Mike Sprague</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/darkly/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://vuejs.mikesprague.me/shared/css/styles.css">
    <style>
      .list-group-item {
        font-weight: lighter;
      }
      .task-check {
        margin-right: 10px;
      }
      .task-text {
        cursor: pointer;
        font-size: 32px;
        line-height: 42px;
      }
      .task-completed {
        text-decoration: line-through;
      }
      .priority-label:nth-of-type(1) {
        margin-left: 54px;
      }
      .priority-label {
        cursor: pointer;
      }
      .priority-label.inactive {
        color: #777;
      }
    </style>
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.3/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>

    <header class="container page-header">
      <h1>Simple Vue.js To-do List App</h1>
      <p class="lead">
        Type text below and hit enter key to add new tasks. Click priority label on task to change it.
        <br>
        <small> Demo uses browser's local storage - task list will persist between visits unless browser's cache is cleared.</small>
      </p>
    </header>

    <div class="container" id="app">
      <div class="row">
        <div class="col-sm-12">
          <todo-list :tasks="allTodos"></todo-list>
        </div>
      </div>
    </div>

    <footer class="footer">
      <footer-content></footer-content>
    </footer>

    <template id="todo-list-template">
      <input class="form-control input-lg" placeholder="What do you need to do?" v-model="newTask" @keypress.enter="addTodo( todo )">
      <hr>
      <i class="fa fa-fw fa-bar-chart"></i>
      <span v-show="!remainingTasks && completedTasks">No Tasks Remaining</span>
      <span v-show="remainingTasks">{{ remainingTasks }} {{ remainingTasks | pluralize "Task" }} Remaining</span>
      <span v-show="totalTasks > 1 && totalTasks > remainingTasks"> of {{ totalTasks }} Total {{ totalTasks | pluralize "Task" }}</span>
      <span v-show="!remainingTasks && !completedTasks">No Tasks in List</span>
      <span v-show="completedTasks"> | <a class="text-warning" href="#" @click.prevent="clearCompleted"><i class="fa fa-fw fa-times"></i>Remove Completed Tasks from List</a></span>
      <a class="text-danger pull-right" href="#" @click.prevent="resetApp">Reset to Default Demo Data<i class="fa fa-fw fa-refresh"></i></a>
      <hr>
      <ul class="list-group">
        <li class="list-group-item" v-for="todo in tasks" todo="todo">
          <div class="row">
            <div class="col-sm-12">
              <i :class="{ 'fa fa-fw fa-2x fa-circle-o task-check': !todo.completed, 'fa fa-fw fa-2x fa-check-circle-o text-success task-check': todo.completed }" @click="toggleTodoStatus( todo )"></i>
              <span :class="{ 'task-text': !todo.completed, 'task-text task-completed text-success': todo.completed }" @click="toggleTodoStatus( todo )">
                {{ todo.task }}
              </span>
              <button class="btn btn-danger btn-sm pull-right" @click="deleteTodo( todo )"><i class="fa fa-2x fa-minus-circle"></i></button>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-12">
              <span @click="togglePriority( todo, 3 )" :class="{ 'label label-default priority-label inactive': todo.priority !== 3 , 'label label-info priority-label': todo.priority === 3 }">Low Priority</span>
              <span @click="togglePriority( todo, 2 )" :class="{ 'label label-default priority-label inactive': todo.priority !== 2 , 'label label-primary priority-label': todo.priority === 2 }">Normal</span>
              <span @click="togglePriority( todo, 1 )" :class="{ 'label label-default priority-label inactive': todo.priority !== 1 , 'label label-danger priority-label': todo.priority === 1 }">High Priority</span>
            </div>
          </div>
        </li>
      </ul>
    </template>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/1.0.26/vue.js"></script>
    <script src="https://www.gstatic.com/firebasejs/3.3.2/firebase.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vuefire/1.3.0/vuefire.js"></script>
    <script src="https://vuejs.mikesprague.me/shared/js/components.js"></script>
    <script>
      var footer = new Vue({
        el: ".footer"
      });

      Vue.component( "todo-list", {
        template: "#todo-list-template",
        props: ['tasks'],
        data: function() {
          return {
            newTask: "",
            taskPriority: 2 // 1: high, 2: normal. 3: low
          }
        },
        created: function() {
          if ( localStorage.todoData ) {
            this.tasks = this.getData( "todoData" );
          } else {
            this.initApp();
          }
        },
        methods: {
          togglePriority: function( task, priority ) {
            task.priority = priority;
            this.setData( "todoData", this.tasks );
          },
          toggleTodoStatus: function( task ) {
            task.completed = !task.completed
            this.setData( "todoData", this.tasks );
          },
          deleteTodo: function( task ) {
            this.tasks.$remove( task );
            this.setData( "todoData", this.tasks );
          },
          addTodo: function() {
            if ( this.newTask.length ) {
              this.tasks.push({
                task: this.newTask,
                priority: this.taskPriority,
                completed: false
              });
              this.newTask = "";
              this.setData( "todoData", this.tasks );
            }
          },
          isComplete: function( task ) {
            return task.completed;
          },
          notComplete: function( task ) {
            return !this.isComplete( task );
          },
          clearCompleted: function() {
            this.tasks = this.tasks.filter( this.notComplete );
            this.setData( "todoData", this.tasks );
          },
          setData: function( key, data ) {
            var todoData = JSON.stringify( data );
            localStorage.setItem( key, todoData );
          },
          getData: function( key ) {
            var todoData = localStorage.getItem( key );
            return JSON.parse( todoData );
          },
          resetApp: function() {
            this.tasks = this.getData( "originalData" );
            this.initApp();
          },
          initApp: function() {
            localStorage.clear();
            this.setData( "todoData", this.tasks );
            this.setData( "originalData", this.tasks );
          }
        },
        computed: {
          completedTasks: function() {
            if ( this.tasks ) {
              return this.tasks.filter( this.isComplete).length;
            }
          },
          remainingTasks: function() {
            if ( this.tasks ) {
              return this.tasks.filter( this.notComplete).length;
            }
          },
          totalTasks: function() {
            if ( this.tasks ) {
              return this.tasks.length;
            }
          }
        }
      });

      var app = new Vue({
        el: "#app",
        data: {
          allTodos: [{
              task: "Do something",
              priority: 2,
              completed: false
            }, {
              task: "Do something else",
              priority: 1,
              completed: true
          }]
        }
      });
    </script>
  </body>
</html>
